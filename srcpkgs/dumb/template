# Template file for 'dumb'
pkgname=dumb
version=2.0.3
revision=2
build_style=cmake
configure_args="-GNinja -DBUILD_SHARED_LIBS=ON
 $(vopt_bool allegro4 BUILD_ALLEGRO4)
 $(vopt_bool examples BUILD_EXAMPLES)"
make_cmd=ninja
hostmakedepends="ninja"
makedepends="$(vopt_if allegro4 allegro4-devel)
 $(vopt_if examples argtable-devel) $(vopt_if examples SDL2-devel)"
short_desc="IT, XM, S3M and MOD player library"
maintainer="Orphaned <orphan@voidlinux.org>"
license="custom:DUMB"
homepage="http://dumb.sourceforge.net/"
distfiles="https://github.com/kode54/dumb/archive/${version}.tar.gz"
checksum=99bfac926aeb8d476562303312d9f47fd05b43803050cd889b44da34a9b2a4f9

# Package build options
build_options="allegro4 examples"
desc_option_allegro4="Enable optional Allegro 4 support"
desc_option_examples="Enable building example programs (dumbplay & dumbout)"
build_options_default="allegro4 examples"

case "$XBPS_TARGET_MACHINE" in
	i686*|x86_64*)
		configure_args+=" -DUSE_SSE=ON"
		;;
	*)
		configure_args+=" -DUSE_SSE=OFF"
		;;
esac

do_install() {
	cd build
	DESTDIR=${DESTDIR} ${make_cmd} install
}

post_install() {
	vdoc README.md
	vlicense LICENSE
}

dumb-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove "usr/lib/*.so"
		vmove usr/include
		vmove usr/lib/pkgconfig
	}
}

if [ "$build_option_examples" ]; then
	dumb-examples_package() {
		short_desc="Reference IT, XM, S3M, MOD player programs using DUMB and SDL2"
		pkg_install() {
			vmove usr/bin
		}
	}
fi
