# Template file for 'midieditor'
pkgname=midieditor
version=3.3.2
revision=1
#archs="i686 x86_64"
build_style=qmake
hostmakedepends="qt5-qmake qt5-host-tools"
makedepends="qt5-multimedia-devel alsa-lib-devel"
depends="desktop-file-utils"
short_desc="Graphical application to edit, play, and record MIDI data"
maintainer="a dinosaur <nick@a-dinosaur.com>"
license="GPL-3.0-or-later"
homepage="https://www.midieditor.org/"
distfiles="https://github.com/markusschwenk/midieditor/archive/${version}.tar.gz"
checksum=5d6e65b336bbaa4a7fd1321c14ff8f3fd506231f392fbce5b605bf051d86816f

post_patch() {
	vsed 's|QUrl::fromLocalFile(QFileInfo("\(metronome/metronome-01.wav\)").absoluteFilePath())|QUrl(":/run_environment/\1")|' -i src/midi/Metronome.cpp

	vsed 's|Version=0.0.1|Version=1.0|' -i packaging/unix/midieditor/MidiEditor.desktop
	vsed 's|\.png||' -i packaging/unix/midieditor/MidiEditor.desktop
	vsed '/^Encoding=/d' -i packaging/unix/midieditor/MidiEditor.desktop
}

pre_configure() {
	export MIDIEDITOR_RELEASE_VERSION_STRING="${version}"
}

do_install() {
	vbin MidiEditor midieditor
	vinstall packaging/unix/midieditor/MidiEditor.desktop 644 usr/share/applications
	vinstall packaging/unix/midieditor/logo48.png 644 usr/share/icons/hicolor/48x48/apps midieditor.png
	vlicense packaging/unix/midieditor/copyright COPYRIGHT
}
